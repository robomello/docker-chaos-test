# chaos-test.conf - Live configuration for mello's home server
# 44 containers, AMD Ryzen 9 5900X + RTX PRO 6000 Blackwell 96GB

# -- PostgreSQL ---------------------------------------------------------------
CHAOS_POSTGRES_CONTAINER="n8n-postgres"
CHAOS_POSTGRES_USER="n8n"
CHAOS_POSTGRES_MAX_CONN=100
CHAOS_POSTGRES_CONN_THRESHOLD=80

# -- Cloudflare Tunnel --------------------------------------------------------
CHAOS_CLOUDFLARE_CONTAINER="cloudflared"

# -- Disk Space ---------------------------------------------------------------
CHAOS_DISK_MOUNTS="/"
CHAOS_DISK_WARN_PCT=90
CHAOS_DISK_CRIT_PCT=95
CHAOS_DISK_RESERVE_MB=500

# -- Fleet Verification -------------------------------------------------------
# Format: "container|health_url|depends_on|timeout"
# Uses pipe delimiter to avoid collision with :// in URLs
CHAOS_FLEET_SERVICES=(
    # Tier 1: Core infrastructure (no deps)
    "n8n-postgres|||120"
    "n8n-redis|||"
    "surrealdb|http://localhost:8001/health||60"
    "ollama|||"
    "ollama-embed|||"

    # Tier 2: Databases / DB UIs (depend on tier 1)
    "nocodb|http://localhost:8090/|n8n-postgres|"
    "surrealist|http://localhost:8002/|surrealdb|"
    "dashclaw-db-1|||"

    # Tier 3: n8n cluster (depends on postgres + redis)
    "n8n-main|http://localhost:5678/healthz|n8n-postgres,n8n-redis|60"
    "n8n-worker-1||n8n-postgres,n8n-redis|45"
    "n8n-worker-2||n8n-postgres,n8n-redis|45"
    "n8n-worker-3||n8n-postgres,n8n-redis|45"

    # Tier 4: Application services
    "commander|http://localhost:8070/||"
    "deep-origins|http://localhost:8060/health||"
    "youtube-uploader|http://localhost:8055/health||"
    "youtube-hunter|http://localhost:8075/health||"
    "factory-agent|http://localhost:8050/health||"
    "skool-api|http://localhost:8091/health||"
    "mcp-server|||"
    "social-scheduler|||"
    "printwalk|http://localhost:3000/||"
    "pawtraits-web|http://localhost:3101/||"
    "pawtraits-worker|||"
    "cortex|http://localhost:9100/||"
    "ocr-server|||"
    "tts-service|||"
    "memory-mcp|||"
    "server-health-monitor|||"

    # Tier 4b: Services depending on postgres
    "claude-telegram||n8n-postgres|"
    "image-telegram|||"
    "etsy-telegram|||"
    "fb-photo-bot|||"
    "ghost-eag|||"
    "langfuse|http://localhost:3001/api/public/health|n8n-postgres|60"

    # Tier 5: External access
    "cloudflared|||"

    # Tier 6: GPU services (long timeout for model loading)
    "comfyui|http://localhost:8188/system_stats||300"
    "whisper-stt|http://localhost:8058/health||120"

    # Monitoring stack
    "prometheus|http://localhost:9090/-/healthy||"
    "loki|http://localhost:3100/ready||"
    "grafana|http://localhost:3002/||"
    "promtail||loki|"
    "cadvisor|http://localhost:8081/||"
)

CHAOS_FLEET_SKIP="n8n-db-cleaner|n8n-video-cleaner"
CHAOS_FLEET_TIMEOUT=90
CHAOS_FLEET_STRATEGY="restart"

# -- Blast Radius: Module-to-Container Mappings -------------------------------
CHAOS_MODULE_CONTAINERS_postgres="n8n-postgres"
CHAOS_MODULE_CONTAINERS_docker_socket=""
CHAOS_MODULE_CONTAINERS_dns=""
CHAOS_MODULE_CONTAINERS_cloudflare="cloudflared"
CHAOS_MODULE_CONTAINERS_disk_space=""
CHAOS_MODULE_CONTAINERS_nvme_health=""

# -- General ------------------------------------------------------------------
CHAOS_VERBOSE=false
